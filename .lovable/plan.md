

# إصلاح تجربة الإشعارات -- الخطة المحدثة

## التغييرات المطلوبة

### 1. إضافة بطاقة "الإشعارات" في صفحة الإعدادات الرئيسية

في ملف `src/pages/DashboardOrganizationSettings.tsx`، إضافة بطاقة ثالثة بنفس تصميم بطاقتي "الصلاحيات" و"الاتصال والمشاركة":
- ايقونة BellRing
- عنوان ووصف مترجمان
- زر ينقل إلى `/dashboard/settings/notifications`
- هذه البطاقة تظهر لجميع المستخدمين (بدون شرط owner/manager) لأن إعدادات الإشعارات شخصية

### 2. إصلاح بانر التفعيل (`PushPermissionBanner.tsx`)

- إزالة شرط `pushState === "granted"` من شرط الإخفاء
- البانر يظهر دائما ما لم يكن `isSubscribed === true` أو `pushState === "denied"`

### 3. تحسين تشخيص فشل الاشتراك (`usePushSubscription.ts`)

- إضافة console.log تفصيلي لتتبع:
  - هل VAPID key موجود؟
  - هل تم إنشاء اشتراك المتصفح؟
  - هل فشل الحفظ في قاعدة البيانات؟
- عرض رسالة خطأ واضحة للمستخدم

---

## التفاصيل التقنية

### الملفات المعدلة

| الملف | التغيير |
|-------|---------|
| `src/pages/DashboardOrganizationSettings.tsx` | إضافة بطاقة الإشعارات بجانب الصلاحيات والاتصال |
| `src/components/push/PushPermissionBanner.tsx` | إزالة `pushState === "granted"` من شرط الإخفاء |
| `src/hooks/usePushSubscription.ts` | إضافة تسجيل تشخيصي مفصل |
| `src/i18n/locales/en.ts` و `ar.ts` | إضافة مفاتيح الترجمة لبطاقة الإشعارات في الإعدادات |

### بطاقة الإشعارات الجديدة في صفحة الإعدادات
ستكون بنفس نمط البطاقات الموجودة:
```text
+------------------------------------------+
| [BellRing]  إعدادات الإشعارات    [فتح >] |
|             إدارة تنبيهات الجهاز          |
+------------------------------------------+
```

### المنطق الجديد للبانر
```text
يظهر البانر إذا:
  isSupported = true
  AND isSubscribed = false
  AND pushState != "denied"

يختفي البانر فقط إذا:
  isSubscribed = true  (تم التسجيل فعليا)
  OR pushState = "denied"  (المستخدم رفض الإذن)
```

