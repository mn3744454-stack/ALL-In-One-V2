

# خطة تنفيذ حل البروكسي الجذري

## الهدف
إنشاء بوابة خلفية (Backend Proxy) تجعل جميع طلبات المصادقة وقاعدة البيانات تمر عبر نفس دومين التطبيق، مما يتجنب أي حجب شبكي.

---

## الملفات المطلوب إنشاؤها

### 1. `supabase/functions/backend-proxy/index.ts`
Edge Function تعمل كبوابة:
- تستقبل الطلبات من الواجهة
- تعيد توجيهها إلى خادم Supabase الحقيقي
- تعيد الاستجابة للواجهة
- تدعم CORS بشكل كامل

### 2. `src/lib/installBackendProxyFetch.ts`
دالة تعدّل `window.fetch` لتحويل الطلبات تلقائياً:
- أي طلب يذهب إلى `supabase.co` يتم تحويله للبروكسي
- بدون تغيير أي كود آخر في التطبيق

---

## الملفات المطلوب تعديلها

### 1. `src/main.tsx`
- إضافة استدعاء `installBackendProxyFetch()` قبل تشغيل التطبيق

### 2. `supabase/config.toml`
- إضافة إعدادات الـ function الجديدة

---

## كيف سيعمل الحل

```text
قبل (يفشل):
  المتصفح ──────> supabase.co (محجوب)

بعد (ينجح):
  المتصفح ──────> نفس دومين التطبيق/backend-proxy ──────> supabase.co
                  (مسموح دائماً)                          (من السيرفر)
```

---

## خطوات الاختبار بعد التنفيذ

1. افتح صفحة `/auth`
2. جرب تسجيل الدخول أو إنشاء حساب جديد
3. يجب أن يعمل بدون "مشكلة اتصال"

